<launch>

  <param name="/use_sim_time" value="true" />
  <arg name="refine_align" default="false" />
  <arg name="save_unwarped" default="false" />
  <arg name="mls_map_path" default="$(find jsk_perception)/config/fisheye_stitcher_grid_xd_yd_3840x1920.yml.gz" />
  <arg name="fovd" value="210" />

  <node name="rosbag_play"
        pkg="rosbag" type="play"
        args="$(find jsk_perception)/sample/data/2022-06-24-20-26-33-people_lidar_in_lab.bag --clock --loop">
  </node>

  <group ns="head_camera" >
    <group ns="rgb">
      <node name="republish"
            pkg="image_transport" type="republish"
            args="compressed raw">
        <remap from="in" to="image_raw" />
        <remap from="out" to="image_raw" />
      </node>
    </group>
    <group ns="depth_registered">
      <node name="republish"
            pkg="image_transport" type="republish"
            args="compressedDepth raw">
        <remap from="in" to="image_raw" />
        <remap from="out" to="image_raw" />
      </node>
    </group>
  </group>

  <include file="$(find openni2_launch)/launch/openni2.launch">
    <arg name="load_driver" value="false"/>
    <arg name="camera" value="head_camera" />
    <arg name="depth_registration" value="true"/>
  </include>

  <group ns="insta360" >
    <node name="republish"
          pkg="image_transport" type="republish"
          args="compressed raw">
      <remap from="in" to="image_raw" />
      <remap from="out" to="image_raw" />
    </node>

    <node name="dual_fisheye_to_panorama"
          pkg="nodelet" type="nodelet"
          args="standalone jsk_perception/DualFisheyeToPanorama">
      <remap from="~input" to="image_raw"/>
      <param name="light_compen" value="false" />
      <param name="refine_align" value="$(arg refine_align)" />
      <param name="fovd" value="$(arg fovd)" />
      <param name="save_unwarped" value="$(arg save_unwarped)" />
      <param name="mls_map_path" value="$(arg mls_map_path)" />
    </node>

  </group>
</launch>
