<launch>
  <arg name="gui" default="true" />
  <arg name="gpu" default="-1" />
  <arg name="coral" default="false" />
  <arg name="launch_coral_device" default="true" />
  <arg name="CORAL_DEPTH_IMAGE" default="/kinect_head/depth_registered/hw_registered/image_rect_raw" />
  <arg name="CORAL_CAMERA_INFO" default="/kinect_head/rgb/camera_info" />

  <include file="$(find jsk_perception)/sample/sample_people_pose_estimation_2d.launch" >
    <arg name="gui" value="false" />
    <arg name="gpu" value="$(arg gpu)" />
    <arg name="coral" value="$(arg coral)" />
    <arg name="launch_coral_device" value="$(arg launch_coral_device)" />
    <arg name="CORAL_DEPTH_IMAGE" value="$(arg CORAL_DEPTH_IMAGE)" />
    <arg name="CORAL_CAMERA_INFO" value="$(arg CORAL_CAMERA_INFO)" />
  </include>
  
  <!-- Coral TPU -->
  <group if="$(arg coral)">
    <node name="people_pose_3d_to_skeleton"
          pkg="jsk_recognition_utils" type="people_pose_3d_to_skeleton.py">
      <remap from="~input" to="people_pose_estimation_2d/pose" />
      <rosparam>
        limb_connection: [[ 1, 3],[ 3, 5],[ 5, 7],[ 7, 9],[ 9,11],
                        [ 1, 2],[ 2, 4],[ 4, 6],[ 6, 8],[ 8,10],
                        [ 7,13],[13,15],[15,17],
                        [ 6,12],[12,14],[14,16],
                        [ 7, 6],[13,12]]
        limb_name: ["nose",
                         "left eye",
                         "right eye",
                         "left ear",
                         "right ear",
                         "left shoulder",
                         "right shoulder",
                         "left elbow",
                         "right elbow",
                         "left wrist",
                         "right wrist",
                         "left hip",
                         "right hip",
                         "left knee",
                         "right knee",
                         "left ankle",
                         "right ankle"]
      </rosparam>
    </node>
  </group>

  <!-- GPU or CPU -->
  <group unless="$(arg coral)">
    <node name="people_pose_3d_to_skeleton"
          pkg="jsk_recognition_utils" type="people_pose_3d_to_skeleton.py">
      <remap from="~input" to="people_pose_estimation_2d/pose" />
      <rosparam>
        limb_connection: [[ 2,  1], [ 1, 16], [ 1, 15], [ 6, 18], [ 3, 17],
                        [ 2,  3], [ 2,  6], [ 3,  4], [ 4,  5], [ 6,  7],
                        [ 7,  8], [ 2,  9], [ 9, 10], [10, 11], [ 2, 12],
                        [12, 13], [13, 14], [15, 17], [16, 18]]
        limb_name: ["Nose",
                         "Neck",
                         "RShoulder",
                         "RElbow",
                         "RWrist",
                         "LShoulder",
                         "LElbow",
                         "LWrist",
                         "RHip",
                         "RKnee",
                         "RAnkle",
                         "LHip",
                         "LKnee",
                         "LAnkle",
                         "REye",
                         "LEye",
                         "REar",
                         "LEar",
                         "Bkg"]
      </rosparam>
    </node>
  </group>
    
  <group if="$(arg gui)" >
    <node name="rviz"
          pkg="rviz" type="rviz"
          args="-d $(find jsk_recognition_utils)/sample/config/sample_people_pose_3d_to_skeleton.rviz">
    </node>
  </group>

</launch>
